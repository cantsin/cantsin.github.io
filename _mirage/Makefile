# Generated by Mirage (Thu, 4 Dec 2014 18:16:07 GMT).

LIBS   = -pkgs lwt.syntax,conduit.mirage,cstruct,io-page,lwt,mirage-clock-xen,mirage-console.xen,mirage-http,mirage-net-xen,mirage-types,mirage-types.lwt,re.str,tcpip.stack-direct
PKGS   = conduit crunch cstruct io-page lwt mirage-clock-xen mirage-conduit mirage-console mirage-http mirage-net-xen mirage-types mirage-xen re tcpip vchan xen-evtchn xen-gnt xenstore
SYNTAX = -tags "syntax(camlp4o),annot,bin_annot,strict_sequence,principal"

FLAGS  = -cflag -g -lflags -g,-linkpkg,-dontlink,unix

XENLIB = $(shell ocamlfind query mirage-xen)

BUILD  = ocamlbuild -classic-display -use-ocamlfind $(LIBS) $(SYNTAX) $(FLAGS)
OPAM   = opam

export PKG_CONFIG_PATH=$(shell opam config var prefix)/lib/pkgconfig

export OPAMVERBOSE=1
export OPAMYES=1

.PHONY: all depend clean build main.native
all: build

depend:
	$(OPAM) install $(PKGS) --verbose

main.native:
	$(BUILD) main.native

main.native.o:
	$(BUILD) main.native.o

build: main.native.o
	pkg-config --print-errors --exists openlibm 'libminios-xen >= 0.2'
	ld -d -static -nostdlib --start-group \
	  $$(pkg-config --static --libs openlibm 'libminios-xen >= 0.2') \
	  _build/main.native.o $(XENLIB)/libocaml.a \
	  $(XENLIB)/libxencaml.a --end-group \
	  -L/usr/lib/ocaml \
	  -lbigarray \
	  -L/home/james/.opam/system/lib/cstruct \
	  -lcstruct_stubs \
	  -L/home/james/.opam/system/lib/tcpip \
	  -ltcpip_stubs \
	  -L/home/james/.opam/system/lib/vchan \
	  -lvchan_stubs \
	  -L/home/james/.opam/system/lib/shared-memory-ring \
	  -lshared_memory_ring_stubs \
	  $(shell gcc -print-libgcc-file-name) \
	  -o mir-www.xen

run: build
	@echo www.xl has been created. Edit it to add VIFs or VBDs
	@echo Then do something similar to: xl create -c www.xl

clean:
	ocamlbuild -clean
